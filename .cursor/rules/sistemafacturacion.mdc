---
alwaysApply: true
---
üéØ Objetivo General
Optimizar el sistema de gesti√≥n de mesas, cobros, caja y turnos en un restaurante, garantizando:

Flujo r√°pido y seguro en la facturaci√≥n y reinicio autom√°tico de mesas.

Control financiero con registro de m√©todos de pago diferenciados.

Gesti√≥n de turnos robusta, con arqueo obligatorio, validaci√≥n de mesas pendientes y continuidad de caja.

Trazabilidad completa de todas las acciones por usuario, terminal y fecha/hora.

üìã CRITERIOS FUNCIONALES COMPLETOS
‚úÖ Gesti√≥n y Cobro de Mesas
Criterio 1: Al presionar "Cobrar", se abre un modal directo de selecci√≥n de comprobante (Ticket, Factura A, Factura B) sin pasos intermedios.

Criterio 2: Si el pago es √∫nico, al seleccionar el m√©todo (Efectivo, Tarjeta, QR, Transferencia), el sistema:

Emite autom√°ticamente el comprobante.

Registra el usuario responsable.

Criterio 3: Para pagos parciales:

Opci√≥n "Pago con m√∫ltiples m√©todos".

Distribuci√≥n de montos validada en tiempo real.

Criterio 4: Tras emisi√≥n del comprobante:

La mesa se reinicia autom√°ticamente:

Vac√≠a art√≠culos.

Quita cliente asociado.

Limpia notas y comentarios.

Reinicia tiempo de ocupaci√≥n.

Cambia estado visual a "Libre" (verde).

Bloqueo en reinicio: Si no se emiti√≥ comprobante, el sistema debe bloquear el reinicio.

Confirmaci√≥n visual: "üéâ Mesa liberada con √©xito - Lista para nuevos clientes".

Criterio 5: La venta y su hist√≥rico:

Se guardan en el sistema de facturaci√≥n y caja.

No quedan datos en la vista operativa de mesas.

Criterio 6: Validaci√≥n en cada apertura de mesa:

validarMesaSinConflictos() asegura que la mesa est√© completamente limpia antes de iniciar consumo.

Criterio 7: Historial de cada mesa (persistente pero no visible operativamente):

json
Copiar
Editar
"historial": [
  {
    "accion": "cobro",
    "usuario": "cajero1",
    "fechaHora": "2025-07-13T14:35:00",
    "detalle": "Ticket fiscal emitido, pago QR"
  },
  {
    "accion": "reinicio",
    "usuario": "cajero1",
    "fechaHora": "2025-07-13T14:37:00",
    "detalle": "Mesa liberada tras cobro completo"
  }
]
‚úÖ Caja y M√©todos de Pago
Visualizaci√≥n exclusiva del efectivo disponible.

Otros m√©todos (tarjeta, QR, transferencia) se registran pero no afectan el efectivo.

F√≥rmula de saldo:
Saldo anterior + Ingresos en efectivo - Retiros - Gastos ¬± Ajustes.

Caja inicial en primer turno absoluto:

Si saldo = $0: Advertencia "Caja inicial en $0. ¬øDesea agregar dinero ahora o continuar?".

‚úÖ Turnos y Control Diario
M√°ximo 3 turnos por d√≠a, sin horario fijo.

Operaci√≥n de mesas bloqueada si el turno no est√° abierto.

Al abrir turno:

Traslado autom√°tico del saldo de caja.

Registro del usuario responsable.

Al cerrar turno:

Validaci√≥n previa: Si hay mesas en rojo o azul (con ticket sin cobrar), el cierre queda bloqueado.

Mensaje: "No puede cerrar el turno. Existen mesas con consumos o cobros pendientes."

Arqueo obligatorio:

Efectivo contado.

Diferencias.

Observaciones.

Usuario responsable.

Cierre del tercer turno:

Bloqueo de aperturas hasta el d√≠a siguiente.

Reinicio autom√°tico del contador de turnos.

üì¶ FLUJO COMPLETO DE OPERACI√ìN
Apertura de Turno:

Asignaci√≥n de n√∫mero de turno.

Registro autom√°tico de saldo y usuario.

Advertencia si saldo = $0.

Gesti√≥n de Mesas:

Selecci√≥n de mesa.

Cobro r√°pido con emisi√≥n directa o parcial.

Reinicio autom√°tico validando que haya comprobante.

Cierre de Turno:

Validaci√≥n de mesas cobradas.

Arqueo obligatorio.

Registro del arqueo y traslado de saldo.

Cierre Diario:

Al cerrar el tercer turno:

Generar reporte consolidado.

Enviar por correo.

üîß FUNCIONES T√âCNICAS CLAVE
reiniciarMesaCompleta(usuarioId)

validarMesaSinConflictos(mesaId)

cerrarTurno(usuarioId)

validarMesasPendientesDeCobro()

realizarArqueo(usuarioId, efectivoContado, observaciones)

generarReporteDiario()

‚ö†Ô∏è VALIDACIONES Y TESTING
No reiniciar mesa sin comprobante.

No cerrar turno con mesas pendientes.

Validaci√≥n autom√°tica en cada acci√≥n cr√≠tica.

Logs completos con:

Usuario.

Fecha/hora.

Dispositivo.

üìä KPIs en el Reporte Diario
Cantidad de mesas cobradas por usuario.

Tiempo promedio de ocupaci√≥n por mesa.

Ticket promedio por mesa.

Formas de pago m√°s usadas.

üß† BENEFICIOS
+40% de optimizaci√≥n en el flujo de cobro.

Cierre contable y operativo sin errores.

Control absoluto de caja y mesas.

Indicadores para la administraci√≥n.

üîç EXTRAS Y UI
Confirmaci√≥n visual en cada reinicio, arqueo y cierre.

Logs y auditor√≠a disponibles por usuario.

Indicador visual del turno activo.

Hist√≥rico de arqueos y ventas.